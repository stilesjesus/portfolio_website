---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all projects and sort by date (newest first)
const projects = await getCollection('projects');
const sortedProjects = projects.sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Get unique tech tags for filtering
const allTech = [...new Set(projects.flatMap(p => p.data.tech))].sort();
---

<BaseLayout title="Projects - JesÃºs Stiles">
  <section class="projects-hero" style="padding: 4rem 0 2rem;">
    <div class="container">
      <h1>My <span class="text-gold">Projects</span></h1>
      <p class="text-dim" style="font-size: 1.125rem; max-width: 600px;">
        From FPGA graphics pipelines to IoT monitoring systems. 
        Each project represents a real problem solved with hardware and software.
      </p>
      
      <!-- Quick Stats -->
      <div style="display: flex; gap: 2rem; margin-top: 2rem; flex-wrap: wrap;">
        <div>
          <span class="text-gold font-mono" style="font-size: 2rem; font-weight: bold;">
            {projects.length}
          </span>
          <p class="text-dim font-mono" style="font-size: 0.875rem;">Total Projects</p>
        </div>
        <div>
          <span class="text-trace font-mono" style="font-size: 2rem; font-weight: bold;">
            {projects.filter(p => p.data.status === 'active').length}
          </span>
          <p class="text-dim font-mono" style="font-size: 0.875rem;">Active Development</p>
        </div>
        <div>
          <span class="text-green font-mono" style="font-size: 2rem; font-weight: bold;">
            {projects.filter(p => p.data.featured).length}
          </span>
          <p class="text-dim font-mono" style="font-size: 0.875rem;">Featured Projects</p>
        </div>
      </div>
    </div>
  </section>
  
  <div class="trace-line"></div>
  
  <!-- Projects Grid -->
  <section class="projects-grid" style="padding: 3rem 0;">
    <div class="container">
      <div class="projects-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
        {sortedProjects.map(project => (
          <article class="project-card">
            <div style="padding: 1.5rem;">
              <!-- Status and Links -->
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div style="display: flex; gap: 0.75rem; align-items: center;">
                  <span class="font-mono text-dim" style="font-size: 0.75rem; text-transform: uppercase;">
                    <span class={`led led-${project.data.status === 'active' ? 'green' : 'gold'}`}></span>
                    {project.data.status}
                  </span>
                  {project.data.comingSoon && (
                    <span class="coming-soon-pill">Coming Soon</span>
                  )}
                </div>
                <div style="display: flex; gap: 1rem;">
                  {project.data.github && (
                    <a href={project.data.github} title="View Code" target="_blank">
                      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                      </svg>
                    </a>
                  )}
                </div>
              </div>
              
              <!-- Title -->
              <h3 style="margin-bottom: 1rem;">
                <a href={`/projects/${project.slug}`} style="color: var(--pcb-silk);">
                  {project.data.title}
                </a>
              </h3>
              
              <!-- Description -->
              <p class="text-dim" style="margin-bottom: 1.5rem; font-size: 0.95rem; line-height: 1.6;">
                {project.data.description}
              </p>
              
              <!-- Tech Stack -->
              <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                {project.data.tech.slice(0, 4).map(tech => (
                  <span class="tech-chip">{tech}</span>
                ))}
                {project.data.tech.length > 4 && (
                  <span class="tech-chip">+{project.data.tech.length - 4}</span>
                )}
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <style>
    .coming-soon-pill {
      font-size: 0.65rem;
      text-transform: uppercase;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      background: rgba(255, 193, 7, 0.1);
      color: var(--pcb-gold);
      border: 1px solid var(--pcb-gold);
      border-radius: 4px;
      white-space: nowrap;
    }
  </style>
</BaseLayout>